params <- newbrazilbase
params$intervention <- ifelse(params$intervention %in% c("protect forest", "protect wetland"), "Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control protect forest", "control protect wetland"), "control Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("manage forest", "manage agriculture"), "Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control manage forest", "control manage agriculture"), "control Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("restore forest"), "Reverse", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control restore forest"), "control Reverse", params$intervention)
intstokeep <- c(action, paste("control", action, sep=" "))
params <- params[params$intervention %in% intstokeep,]
futuredf <- data.frame(intervention=c(rep(action, 1), rep(paste("control", action, sep=" "), 1)))
futuredf$start <- start
start = 2022
end = 2027
action = "Avoid"
investment = 10
start = 2022
end = 2027
rds <- 10
pas <- 0
temp <- 2
pdsi <- -2
futuredf$start <- start
futuredf$end <- end
View(params)
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
conpronames <- unique(params$NAME[params$intervention %in% c("control Avoid")])
mannames <- unique(params$NAME[params$intervention %in% c("Reduce")])
conmannames <- unique(params$NAME[params$intervention %in% c("control Reduce", "control Reduce")])
resnames <- unique(params$NAME[params$intervention %in% c("Reverse")])
conresnames <- unique(params$NAME[params$intervention %in% c("control Reverse")])
futuredf$NAME <- ifelse(futuredf$intervention=="Avoid",
sample(pronames, length(1), replace=TRUE), NA)
futuredf$NAME <- ifelse(futuredf$intervention=="control Avoid",
sample(conpronames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="reduce",
sample(mannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control reduce",
sample(conmannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="reverse",
sample(resnames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control reverse",
sample(conresnames, length(1), replace=TRUE), futuredf$NAME)
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
NAME <- rep(futuredf$NAME[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, NAME, year)
futdf <- rbind(futdf, fooadd)
}
params <- params[params$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
params <- params[!duplicated(params$NAME),]
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
futdf <- futdf[complete.cases(futdf),]
for(i in c(1:nrow(futdf))){ #i=1
futdf$mst[i] <- rnorm(1, futdf$mst[i] + temp, 0.05)
futdf$pdsi[i] <- rnorm(1, futdf$pdsi[i] + pdsi, 0.05)
futdf$pas[i] <- rnorm(1, futdf$pas[i] + pas, 0.1)
futdf$numrds[i] <- rnorm(1, futdf$numrds[i] + rds, 50)
futdf$cost[i] <- investment/1000000
}
View(futdf)
brazil <- futdf[!duplicated(futdf),]
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control manage", "control protect", "control restore")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$accum.cost <- ave(brazil.stan$costperyr, brazil.stan$start, brazil.stan$end, brazil.stan$intervention,
brazil.stan$NAME, FUN=cumsum)
#### Let's explore rate of temperature and precip changes
brazil.stan <- brazil.stan %>%
group_by(intervention, NAME, start, end, cost) %>%
arrange(year) %>%
dplyr::mutate(prevpdsi = lag(pdsi, default = first(pdsi))) %>%
dplyr::mutate(prevmst = lag(mst, default = first(mst)))
brazil.stan <- brazil.stan[brazil.stan$yrsofproject>0,]
brazil.stan$mstrate <- (brazil.stan$mst-brazil.stan$prevmst) ## Annual rate of change
brazil.stan$pdsirate <- (brazil.stan$pdsi-brazil.stan$prevpdsi) ## annual rate of change
controls <- c("control protect", "control manage", "control restore")
brazilsub <- brazil.stan[brazil.stan$year <= brazil.stan$end,]
brazilsub$yrsofproject <- ifelse(brazilsub$intervention %in% controls, 0, brazilsub$yrsofproject)
brazilsub$yrs.z <- (brazilsub$yrsofproject-mean(brazilsub$yrsofproject,na.rm=TRUE))/(2*sd(brazilsub$yrsofproject,na.rm=TRUE))
brazilsub$mst.z <- (brazilsub$mst-mean(brazilsub$mst,na.rm=TRUE))/(2*sd(brazilsub$mst,na.rm=TRUE))
brazilsub$pdsi.z <- (brazilsub$pdsi-mean(brazilsub$pdsi,na.rm=TRUE))/(2*sd(brazilsub$pdsi,na.rm=TRUE))
brazilsub$rds.z <- (brazilsub$numrds-mean(brazilsub$numrds,na.rm=TRUE))/(2*sd(brazilsub$numrds,na.rm=TRUE))
brazilsub$elev.z <- (brazilsub$elev-mean(brazilsub$elev,na.rm=TRUE))/(2*sd(brazilsub$elev,na.rm=TRUE))
brazilsub$slope.z <- (brazilsub$slope-mean(brazilsub$slope,na.rm=TRUE))/(2*sd(brazilsub$slope,na.rm=TRUE))
brazilsub$pas.z <- (brazilsub$pas-mean(brazilsub$pas,na.rm=TRUE))/(2*sd(brazilsub$pas,na.rm=TRUE))
brazilsub$cost.z <- (brazilsub$costperyr-mean(brazilsub$costperyr,na.rm=TRUE))/(2*sd(brazilsub$costperyr,na.rm=TRUE))
brazilsub$mstrate.z <- (brazilsub$mstrate-mean(brazilsub$mstrate,na.rm=TRUE))/(2*sd(brazilsub$mstrate,na.rm=TRUE))
brazilsub$prate.z <- (brazilsub$pdsirate-mean(brazilsub$pdsirate,na.rm=TRUE))/(2*sd(brazilsub$pdsirate,na.rm=TRUE))
##### Predict response now instead with new data...
newdat <- brazilsub
View(newdat)
runApp()
foreuser <- newdat
preddata <- predict(mod1, foreuser, allow_new_levels=TRUE, probs=c(0.25, 0.75))
warnings()
View(newdat)
View(brazil.stan)
brazil.stan$cost
brazil.stan$numyrs
brazil.stan$cost/brazil.stan$numyrs
mod1 <- load("source/models/lcrate_brms_2levelitvn_allyears_10yr_noyrcont_costperyr.Rdata")
runApp()
runApp()
runApp()
runApp()
runApp()
View(newdat)
runApp()
runApp()
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control Reduce", "control Avoid", "control Reverse")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$intervention %in% c("Avoid", "Reduce", "Reverse"),
brazil.stan$costperyr + rnorm(1, 0, 0.01), brazil.stan$costperyr)
brazil.stan$accum.cost <- ave(brazil.stan$costperyr, brazil.stan$start, brazil.stan$end, brazil.stan$intervention,
brazil.stan$NAME, FUN=cumsum)
View(brazil.stan)
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control Reduce", "control Avoid", "control Reverse")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$costperyr + rnorm(1, 0, 0.01)
rnorm(1, 0, 0.01)
brazil.stan$costperyr
rnorm(1, 0, 0.01)
for(i in c(1:nrow(brazil.stan))) {
brazil.stan$costperyr[i] <- ifelse(brazil.stan$intervention[i] %in% c("Avoid", "Reduce", "Reverse"),
brazil.stan$costperyr[i] + rnorm(1, 0, 0.01), brazil.stan$costperyr[i])
}
brazil.stan$costperyr <- brazil.stan$cost/brazil.stan$numyrs
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$costperyr[i]
i=1
brazil.stan$costperyr[i]
rnorm(1, 0, 0.01)
1 + rnorm(1, 0, 0.01)
brazil.stan$costperyr[i] + rnorm(1, 0, 0.01)
(brazil.stan$costperyr[i] + rnorm(1, 0, 0.01))
(brazil.stan$costperyr[i]) + rnorm(1, 0, 0.01)
str(brazil.stan)
rnorm(1, 100, 0.01)
brazil.stan$costperyr[i] + rnorm(1, 100, 0.01)
brazil.stan$costperyr[i] + rnorm(1, 1000, 0.01)
brazil.stan$costperyr[i]
brazil.stan$costperyr <- (brazil.stan$cost/brazil.stan$numyrs)/1000000
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
for(i in c(1:nrow(brazil.stan))) { #i=1
brazil.stan$costperyr[i] <- ifelse(brazil.stan$intervention[i] %in% c("Avoid", "Reduce", "Reverse"),
brazil.stan$costperyr[i] + rnorm(1, 1, 0.01), brazil.stan$costperyr[i])
}
brazil.stan$costperyr <- (brazil.stan$cost/brazil.stan$numyrs)/1000000
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$costperyr[i]
i=1
brazil.stan$costperyr[i]
brazil.stan$costperyr <- (brazil.stan$cost/brazil.stan$numyrs)/1000
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
brazil.stan$costperyr[i]
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
runApp()
runApp()
action = "Reverse"
investment = 10
start = 2022
end = 2027
rds <- 10
pas <- 0
temp <- 2
pdsi <- -2
action <- as.character(action)
investment <- as.numeric(investment)
start <- as.numeric(start)
end <- as.numeric(end)
rds <- as.numeric(rds)
pas <- as.numeric(pas)
temp <- as.numeric(temp)
pdsi <- as.numeric(pdsi)
newbrazil <- brazil
##### Let's simulate forecasted data here:
newbrazilbase <- subset(newbrazil, select=c("lc_ha_rate", "intervention", "NAME", "pdsi",
"numrds", "mst", "elev", "slope", "pas", "forest",
"yrsofproject", "accum.cost", "prevforest", "year"))
params$intervention <- ifelse(params$intervention %in% c("protect forest", "protect wetland"), "Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control protect forest", "control protect wetland"), "control Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("manage forest", "manage agriculture"), "Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control manage forest", "control manage agriculture"), "control Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("restore forest"), "Reverse", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control restore forest"), "control Reverse", params$intervention)
brazil <- read.csv("source/clean_brazil_stan.csv")
newbrazil <- brazil
##### Let's simulate forecasted data here:
newbrazilbase <- subset(newbrazil, select=c("lc_ha_rate", "intervention", "NAME", "pdsi",
"numrds", "mst", "elev", "slope", "pas", "forest",
"yrsofproject", "accum.cost", "prevforest", "year"))
newbrazilbase <- newbrazilbase[!duplicated(newbrazilbase),]
newbrazilbase <- newbrazilbase[complete.cases(newbrazilbase),]
params <- newbrazilbase
params$intervention <- ifelse(params$intervention %in% c("protect forest", "protect wetland"), "Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control protect forest", "control protect wetland"), "control Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("manage forest", "manage agriculture"), "Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control manage forest", "control manage agriculture"), "control Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("restore forest"), "Reverse", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control restore forest"), "control Reverse", params$intervention)
intstokeep <- c(action, paste("control", action, sep=" "))
params <- params[params$intervention %in% intstokeep,]
futuredf <- data.frame(intervention=c(rep(action, 1), rep(paste("control", action, sep=" "), 1)))
futuredf$start <- start
futuredf$end <- end
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
conpronames <- unique(params$NAME[params$intervention %in% c("control Avoid")])
mannames <- unique(params$NAME[params$intervention %in% c("Reduce")])
conmannames <- unique(params$NAME[params$intervention %in% c("control Reduce", "control Reduce")])
resnames <- unique(params$NAME[params$intervention %in% c("Reverse")])
conresnames <- unique(params$NAME[params$intervention %in% c("control Reverse")])
futuredf$NAME <- ifelse(futuredf$intervention=="Avoid",
sample(pronames, length(1), replace=TRUE), NA)
futuredf$NAME <- ifelse(futuredf$intervention=="control Avoid",
sample(conpronames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="reduce",
sample(mannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control reduce",
sample(conmannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="reverse",
sample(resnames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control reverse",
sample(conresnames, length(1), replace=TRUE), futuredf$NAME)
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
NAME <- rep(futuredf$NAME[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, NAME, year)
futdf <- rbind(futdf, fooadd)
}
params <- params[params$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
params <- params[!duplicated(params$NAME),]
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
futdf <- futdf[complete.cases(futdf),]
for(i in c(1:nrow(futdf))){ #i=1
futdf$mst[i] <- rnorm(1, futdf$mst[i] + temp, 0.05)
futdf$pdsi[i] <- rnorm(1, futdf$pdsi[i] + pdsi, 0.05)
futdf$pas[i] <- rnorm(1, futdf$pas[i] + pas, 0.1)
futdf$numrds[i] <- rnorm(1, futdf$numrds[i] + rds, 50)
futdf$cost[i] <- investment*1000000
}
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
NAME <- rep(futuredf$NAME[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, NAME, year)
futdf <- rbind(futdf, fooadd)
}
params <- params[params$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
params <- params[!duplicated(params$NAME),]
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
View(futdf)
runApp()
mean(brazil$cost)
runApp()
View(brazil.stan)
View(futdf)
newbrazil <- brazil
savebrazil <- brazil
##### Let's simulate forecasted data here:
newbrazilbase <- subset(newbrazil, select=c("lc_ha_rate", "intervention", "NAME", "pdsi",
"numrds", "mst", "elev", "slope", "pas", "forest",
"yrsofproject", "accum.cost", "prevforest", "year"))
newbrazilbase <- newbrazilbase[!duplicated(newbrazilbase),]
newbrazilbase <- newbrazilbase[complete.cases(newbrazilbase),]
params <- newbrazilbase
params$intervention <- ifelse(params$intervention %in% c("protect forest", "protect wetland"), "Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control protect forest", "control protect wetland"), "control Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("manage forest", "manage agriculture"), "Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control manage forest", "control manage agriculture"), "control Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("restore forest"), "Reverse", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control restore forest"), "control Reverse", params$intervention)
intstokeep <- c(action, paste("control", action, sep=" "))
params <- params[params$intervention %in% intstokeep,]
futuredf <- data.frame(intervention=c(rep(action, 1), rep(paste("control", action, sep=" "), 1)))
futuredf$start <- start
futuredf$end <- end
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
start = 2022
end = 2027
futuredf$start <- start
futuredf$end <- end
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
conpronames <- unique(params$NAME[params$intervention %in% c("control Avoid")])
mannames <- unique(params$NAME[params$intervention %in% c("Reduce")])
conmannames <- unique(params$NAME[params$intervention %in% c("control Reduce", "control Reduce")])
resnames <- unique(params$NAME[params$intervention %in% c("Reverse")])
conresnames <- unique(params$NAME[params$intervention %in% c("control Reverse")])
futuredf$NAME <- ifelse(futuredf$intervention=="Avoid",
sample(pronames, length(1), replace=TRUE), NA)
futuredf$NAME <- ifelse(futuredf$intervention=="control Avoid",
sample(conpronames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="Reduce",
sample(mannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control Reduce",
sample(conmannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="Reverse",
sample(resnames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control Reverse",
sample(conresnames, length(1), replace=TRUE), futuredf$NAME)
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
NAME <- rep(futuredf$NAME[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, NAME, year)
futdf <- rbind(futdf, fooadd)
}
params <- params[params$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
params <- params[!duplicated(params$NAME),]
futdf <- dplyr::left_join(futdf, params)
futdf <- futdf[!duplicated(futdf),]
futdf <- futdf[complete.cases(futdf),]
for(i in c(1:nrow(futdf))){ #i=1
futdf$mst[i] <- rnorm(1, futdf$mst[i] + temp, 0.05)
futdf$pdsi[i] <- rnorm(1, futdf$pdsi[i] + pdsi, 0.05)
futdf$pas[i] <- rnorm(1, futdf$pas[i] + pas, 0.1)
futdf$numrds[i] <- rnorm(1, futdf$numrds[i] + rds, 50)
futdf$cost[i] <- investment*100000
}
brazil <- futdf[!duplicated(futdf),]
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control Reduce", "control Avoid", "control Reverse")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- (brazil.stan$cost/brazil.stan$numyrs)
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
for(i in c(1:nrow(brazil.stan))) { #i=1
brazil.stan$costperyr[i] <- ifelse(brazil.stan$intervention[i] %in% c("Avoid", "Reduce", "Reverse"),
brazil.stan$costperyr[i] + rnorm(1, 100, 0.01), brazil.stan$costperyr[i])
}
View(brazil.stan)
brazil.stan <- subset(brazil,
select=c("start", "end", "intervention", "cost", "NAME", "year",
"pdsi", "numrds", "mst", "elev", "slope", "pas"))
brazil.stan <- brazil.stan %>% dplyr::group_by(start, end, intervention, NAME, cost) %>%
dplyr::arrange(year)
brazil.stan$yrsofproject <- (brazil.stan$year - brazil.stan$start) + 1
brazil.stan <- brazil.stan[(brazil.stan$yrsofproject >= 0),]
# Establish investments per year per project and then look at accumulated investment over time
controls <- c("control Reduce", "control Avoid", "control Reverse")
brazil.stan$cost <- ifelse(brazil.stan$intervention %in% controls, 0, brazil.stan$cost)
brazil.stan$numyrs <- (brazil.stan$end - brazil.stan$start) #+ 1
brazil.stan$costperyr <- (brazil.stan$cost/brazil.stan$numyrs)
brazil.stan$costperyr <- ifelse(brazil.stan$year > brazil.stan$end, 0, brazil.stan$costperyr)
brazil.stan$costperyr <- ifelse(brazil.stan$year < brazil.stan$start, 0, brazil.stan$costperyr)
for(i in c(1:nrow(brazil.stan))) { #i=1
brazil.stan$costperyr[i] <- ifelse(brazil.stan$intervention[i] %in% c("Avoid", "Reduce", "Reverse"),
brazil.stan$costperyr[i] + rnorm(1, 100, 5), brazil.stan$costperyr[i])
}
brazil.stan$accum.cost <- ave(brazil.stan$costperyr, brazil.stan$start, brazil.stan$end, brazil.stan$intervention,
brazil.stan$NAME, FUN=cumsum)
#### Let's explore rate of temperature and precip changes
brazil.stan <- brazil.stan %>%
group_by(intervention, NAME, start, end, cost) %>%
arrange(year) %>%
dplyr::mutate(prevpdsi = lag(pdsi, default = first(pdsi))) %>%
dplyr::mutate(prevmst = lag(mst, default = first(mst)))
brazil.stan <- brazil.stan[brazil.stan$yrsofproject>0,]
brazil.stan$mstrate <- (brazil.stan$mst-brazil.stan$prevmst) ## Annual rate of change
brazil.stan$pdsirate <- (brazil.stan$pdsi-brazil.stan$prevpdsi) ## annual rate of change
controls <- c("control Avoid", "control Reduce", "control Reverse")
brazilsub <- brazil.stan[brazil.stan$year <= brazil.stan$end,]
brazilsub$yrsofproject <- ifelse(brazilsub$intervention %in% controls, 0, brazilsub$yrsofproject)
brazilsub$yrs.z <- (brazilsub$yrsofproject-mean(brazilsub$yrsofproject,na.rm=TRUE))/(2*sd(brazilsub$yrsofproject,na.rm=TRUE))
brazilsub$mst.z <- (brazilsub$mst-mean(brazilsub$mst,na.rm=TRUE))/(2*sd(brazilsub$mst,na.rm=TRUE))
brazilsub$pdsi.z <- (brazilsub$pdsi-mean(brazilsub$pdsi,na.rm=TRUE))/(2*sd(brazilsub$pdsi,na.rm=TRUE))
brazilsub$rds.z <- (brazilsub$numrds-mean(brazilsub$numrds,na.rm=TRUE))/(2*sd(brazilsub$numrds,na.rm=TRUE))
brazilsub$elev.z <- (brazilsub$elev-mean(brazilsub$elev,na.rm=TRUE))/(2*sd(brazilsub$elev,na.rm=TRUE))
brazilsub$slope.z <- (brazilsub$slope-mean(brazilsub$slope,na.rm=TRUE))/(2*sd(brazilsub$slope,na.rm=TRUE))
brazilsub$pas.z <- (brazilsub$pas-mean(brazilsub$pas,na.rm=TRUE))/(2*sd(brazilsub$pas,na.rm=TRUE))
brazilsub$cost.z <- (brazilsub$costperyr-mean(brazilsub$costperyr,na.rm=TRUE))/(2*sd(brazilsub$costperyr,na.rm=TRUE))
brazilsub$mstrate.z <- (brazilsub$mstrate-mean(brazilsub$mstrate,na.rm=TRUE))/(2*sd(brazilsub$mstrate,na.rm=TRUE))
brazilsub$prate.z <- (brazilsub$pdsirate-mean(brazilsub$pdsirate,na.rm=TRUE))/(2*sd(brazilsub$pdsirate,na.rm=TRUE))
runApp()
newbrazil <- savebrazil
##### Let's simulate forecasted data here:
newbrazilbase <- subset(newbrazil, select=c("lc_ha_rate", "intervention", "NAME", "pdsi",
"numrds", "mst", "elev", "slope", "pas", "forest",
"yrsofproject", "accum.cost", "prevforest", "year"))
newbrazilbase <- newbrazilbase[!duplicated(newbrazilbase),]
newbrazilbase <- newbrazilbase[complete.cases(newbrazilbase),]
params <- newbrazilbase
params$intervention <- ifelse(params$intervention %in% c("protect forest", "protect wetland"), "Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control protect forest", "control protect wetland"), "control Avoid", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("manage forest", "manage agriculture"), "Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control manage forest", "control manage agriculture"), "control Reduce", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("restore forest"), "Reverse", params$intervention)
params$intervention <- ifelse(params$intervention %in% c("control restore forest"), "control Reverse", params$intervention)
intstokeep <- c(action, paste("control", action, sep=" "))
params <- params[params$intervention %in% intstokeep,]
futuredf <- data.frame(intervention=c(rep(action, 1), rep(paste("control", action, sep=" "), 1)))
futuredf$start <- start
futuredf$end <- end
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
start = 2022
end = 2027
futuredf$start <- start
futuredf$end <- end
pronames <- unique(params$NAME[params$intervention %in% c("Avoid")])
conpronames <- unique(params$NAME[params$intervention %in% c("control Avoid")])
mannames <- unique(params$NAME[params$intervention %in% c("Reduce")])
conmannames <- unique(params$NAME[params$intervention %in% c("control Reduce", "control Reduce")])
resnames <- unique(params$NAME[params$intervention %in% c("Reverse")])
conresnames <- unique(params$NAME[params$intervention %in% c("control Reverse")])
futuredf$NAME <- ifelse(futuredf$intervention=="Avoid",
sample(pronames, length(1), replace=TRUE), NA)
futuredf$NAME <- ifelse(futuredf$intervention=="control Avoid",
sample(conpronames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="Reduce",
sample(mannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control Reduce",
sample(conmannames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="Reverse",
sample(resnames, length(1), replace=TRUE), futuredf$NAME)
futuredf$NAME <- ifelse(futuredf$intervention=="control Reverse",
sample(conresnames, length(1), replace=TRUE), futuredf$NAME)
futdf <- data.frame()
for(i in c(1:nrow(futuredf))) { #i=1
numreps <- futuredf$end[i]-futuredf$start[i] + 1
intervention <- rep(futuredf$intervention[i], each=numreps)
start <- rep(futuredf$start[i], each=numreps)
end <- rep(futuredf$end[i], each=numreps)
NAME <- rep(futuredf$NAME[i], each=numreps)
year <- futuredf$start[i]:futuredf$end[i]
fooadd <- data.frame(intervention, start, end, NAME, year)
futdf <- rbind(futdf, fooadd)
}
params <- params[params$year==2020,]
params$lc_ha_rate <- params$prevforest <- NULL
params$year <- params$forest <- params$yrsofproject <- NULL
runApp()
